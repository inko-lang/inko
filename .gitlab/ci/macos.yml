---
.macos-tags:
  tags:
    - macos
    - inko
    - vbox

test:rust:macos:
  extends:
    - .only-source-repository
    - .only-rust-changes
    - .macos-tags
  stage: test
  before_script:
    - rustc --version
    - cargo --version
  script:
    - env LLVM_CONFIG_PATH="$(brew --prefix llvm)/bin/llvm-config" cargo test
  cache:
    key: macos
    paths:
      - .cargo
      - target

test:libstd:macos:
  extends:
    - .only-source-repository
    - .only-libstd-changes
    - .macos-tags
  stage: test
  before_script:
    - rustc --version
    - cargo --version
  script:
    - cd libstd
    - env LLVM_CONFIG_PATH="$(brew --prefix llvm)/bin/llvm-config"
      cargo run --release -p inko -- test
  cache:
    key: macos
    paths:
      - .cargo
      - target
