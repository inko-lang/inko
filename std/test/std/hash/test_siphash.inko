import std.hash.siphash (SipHasher13)
import std.test (Tests)

let KEY0 = 0x0706050403020100
let KEY1 = 0x0F0E0D0C0B0A0908
let EXPECTED = [
  -6076480319675972388, -3894316307686372717, -9021946994309475251,
  -8360920918932981765, -3497793463459282136, -2379636529018225817,
  -4247691247627591001, -3201358290706427584, 3931806377309739662,
  2712449776846519780, 8781603583133944191, 8124802424143463250,
  8692937602970737058, 3490138030451851175, 6943038873169124660,
  -3233346569078990506, -3724515260966597786, -7137527490068883444,
  -8071514186461223362, -999906983011582692, -4549709543058382784,
  -5074804721957078972, 9222944995288319790, 5934071401310241059,
  -836351549525156724, 5029774389061290361, 4196851155228758949,
  -6260628767897666763, -356931148583219187, -8585764469560188428,
  6057079635794323043, 2553784116283822524, -9145267764139149811,
  5572283034219051455, 8475513330862814526, -3557382191000818799,
  3239505212207161862, -5327727376832712617, -5479626656086083935,
  7091858058578527122, -4480459088322095823, 7384990322848880964,
  7309430150919325733, 2662331968129681830, -4410681076612561045,
  -4461294832492207722, -6814337029234371037, 5330879445531170045,
  -6975719611647439802, -4107934715622947149, 9128596131873425807,
  2086032310832541594, -4302572765519274222, 3961735597980589776,
  3571270170472135910, -6738863651867334272, -5423247803822609035,
  2592059436507272467, -8141558914245359096, -2838163980098670264,
  -651642346778770194, -5853101887941232654, -4345140119139347232,
  -7126506181673372760,
]

fn pub tests(t: mut Tests) {
  t.test('SipHasher13.finish', fn (t) {
    let buf = []

    for (index, exp) in EXPECTED.iter.with_index {
      let hasher = SipHasher13.new(KEY0, KEY1)

      for v in buf.iter { hasher.write_byte(v) }

      t.equal(hasher.finish, exp)
      buf.push(index)
    }
  })
}
